<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ƒê√™m Trung Thu ‚Äì n∆°i th·∫£ ƒë√®n tr·ªùi, ng·∫Øm trƒÉng v√† g·ª≠i l·ªùi ch√∫c ng·ªçt ng√†o nh·∫•t.">
  <meta name="theme-color" content="#ff7f50">
  <title>ƒê√™m Trung Thu</title>
  <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #060614;
      font-family: 'Mali', cursive;
      overflow: hidden;
    }

    .stage {
      position: relative;
      width: 100%;
      min-height: 100vh;
      overflow: hidden;
    }

    canvas#starfield {
      display: block;
      width: 100%;
      height: 100%;
    }

    .moon {
      position: absolute;
      top: 60px;
      right: 100px;
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #f8f8f8 70%, #e0e0e0 100%);
      box-shadow:
        0 0 50px #ffffff7a,
        0 0 80px rgba(255, 255, 255, 0.7),
        0 0 100px rgba(255, 255, 255, 0.4);
      filter: drop-shadow(0 0 25px rgba(255, 255, 200, 0.8));
      animation: moonGlow 6s ease-in-out infinite;
      z-index: 10;
    }

    @keyframes moonGlow {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.85; }
    }

    #lantern-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 10;
    }

    .lantern {
      position: absolute;
      width: 40px;
      pointer-events: auto;
      user-select: none;
      animation: swing 2.2s ease-in-out infinite;
      transition: transform 0.3s ease-in-out;
    }

    @keyframes swing {
      0% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
      100% { transform: rotate(-5deg); }
    }

    #hint {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      color: #ffa722;
      font-weight: 800;
      font-size: clamp(16px, 4vw, 28px);
      opacity: 0;
      animation: glowHint 2.5s ease-in-out infinite alternate;
      z-index: 1000;
      text-align: center;
      text-shadow: 0 0 15px #ff8a50, 0 0 25px #ffd180;
    }

    @keyframes glowHint {
      0% { opacity: 0.3; text-shadow: 0 0 10px #ffb380, 0 0 20px #ffda91; }
      100% { opacity: 1; text-shadow: 0 0 25px #ffae50, 0 0 35px #ffd180; }
    }

    #wish-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: rgba(255, 255, 255, 0.96);
      color: #ff8d22;
      padding: 25px 30px;
      border-radius: 12px;
      font-size: clamp(1rem, 3vw, 1.8rem);
      font-weight: 700;
      display: none;
      opacity: 0;
      text-align: center;
      box-shadow: 0 0 20px #ff8a50, 0 0 25px #ffd180;
      z-index: 9999;
      transition: all 0.5s ease;
    }

    #wish-popup.show {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    #intro-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      z-index: 99999;
      opacity: 1;
      transition: opacity 1.2s ease;
      color: #ffa722;
      font-size: clamp(16px, 4vw, 24px);
      font-weight: 700;
      text-shadow: 0 0 15px #ff8a50, 0 0 25px #ffd180;
      line-height: 1.7;
      pointer-events: none;
    }

    .intro-line {
      opacity: 0;
      transition: opacity 1.2s ease;
    }

    .intro-line.show {
      opacity: 0.85;
    }

    @media (max-width:600px) {
      .moon { top: 40px; right: 14px; width: 70px; height: 70px; }
      #hint { bottom: 60px; }
      #wish-popup { max-width: 85%; }
      #intro-overlay { padding: 20px; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <canvas id="starfield"></canvas>
    <div class="moon"></div>
    <div id="lantern-container"></div>
    <div id="wish-popup"></div>
    <div id="hint">Ch·∫°m v√†o ƒë√®n tr·ªùi s·∫Ω c√≥ ƒëi·ªÅu b·∫•t ng·ªù</div>
    <div id="intro-overlay"></div>

    <audio id="bg-music" loop preload="auto">
      <source src="a.mp3" type="audio/mp3" />
    </audio>
  </div>

  <script>
  window.addEventListener("DOMContentLoaded", () => {

    const introLines = [
      "Ng√†y b√©, Trung thu l√† ƒë√®n l·ªìng, l√† b√°nh n∆∞·ªõng, l√† r∆∞·ªõc ƒë√®n c√πng l≈© b·∫°n.",
      "Gi·ªù l·ªõn r·ªìi... Trung thu l√† nh·ªØng ho√†i ni·ªám, l√† mong ∆∞·ªõc ƒë∆∞·ª£c quay v·ªÅ nh·ªØng ng√†y v√¥ lo v√¥ nghƒ©.",
      "Nh∆∞ng... ƒê·ª´ng v√¨ tr∆∞·ªüng th√†nh, v√¨ b·ªôn b·ªÅ c√¥ng vi·ªác m√† qu√™n m·∫•t b·∫£n th√¢n c≈©ng c·∫ßn ƒë∆∞·ª£c y√™u th∆∞∆°ng.",
      "H√£y s·ªëng ch·∫≠m l·∫°i m·ªôt ch√∫t... ƒë·ªÉ c·∫£m nh·∫≠n √°nh trƒÉng, v·ªã b√°nh, v√† nh·ªØng ƒëi·ªÅu gi·∫£n d·ªã t·ª´ng khi·∫øn ta h·∫°nh ph√∫c."
      "Êúà‰∫ÆÊÖ¢ÊÖ¢ÂèòÂúÜ,‰∫ã‰∫ãÊÖ¢ÊÖ¢Â¶ÇÊÑø
      V·∫ßng trƒÉng d·∫ßn tr√≤n v√†nh v·∫°nh
      Mu√¥n s·ª± tr√™n ƒë√¥i d·∫ßn to·∫°i ∆∞·ªõc mong".
    ];

    const introBox = document.getElementById("intro-overlay");
    const hint = document.getElementById("hint");
    hint.style.opacity = "0";

    async function typeLine(line, element, delay = 40) {
      let text = "";
      for (const ch of line) {
        text += ch;
        element.textContent = text;
        await new Promise(r => setTimeout(r, delay));
      }
    }

    async function playIntro(lines) {
      for (const line of lines) {
        const p = document.createElement("div");
        p.className = "intro-line";
        introBox.appendChild(p);
        setTimeout(() => p.classList.add("show"), 50);
        await typeLine(line, p, 45);
        await new Promise(r => setTimeout(r, 800));
        p.classList.remove("show");
        await new Promise(r => setTimeout(r, 600));
      }

      await new Promise(r => setTimeout(r, 1000));
      introBox.style.opacity = "0";
      setTimeout(() => introBox.remove(), 1500);
      setTimeout(() => {
        hint.style.transition = "opacity 1.8s ease";
        hint.style.opacity = "1";
      }, 2500);
    }

    playIntro(introLines);

    const canvas = document.getElementById("starfield");
    const ctx = canvas.getContext("2d");
    let w, h, stars = [], meteors = [];

    function resizeCanvas() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      stars = Array.from({ length: Math.round((w * h) / 2200) }, () => ({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 0.9 + 0.1,
        a: Math.random() * 0.8 + 0.2,
        t: Math.random() * 0.02 + 0.002
      }));
    }

    function drawStars() {
      ctx.clearRect(0, 0, w, h);
      for (const s of stars) {
        s.a += (Math.random() > 0.5 ? 1 : -1) * s.t;
        s.a = Math.max(0.05, Math.min(1, s.a));
        ctx.beginPath();
        ctx.globalAlpha = s.a;
        ctx.fillStyle = "#fff";
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function createMeteor() {
      meteors.push({
        x: Math.random() * w,
        y: Math.random() * (h / 3),
        vx: 12 + Math.random() * 6,
        vy: 6 + Math.random() * 3,
        len: 100 + Math.random() * 80,
        a: 1
      });
    }

    function drawMeteors() {
      for (let i = meteors.length - 1; i >= 0; i--) {
        const m = meteors[i];
        const x2 = m.x - m.len;
        const y2 = m.y - m.len / 2;
        const grad = ctx.createLinearGradient(m.x, m.y, x2, y2);
        grad.addColorStop(0, `rgba(255,255,255,${m.a})`);
        grad.addColorStop(1, "rgba(255,255,255,0)");
        ctx.strokeStyle = grad;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(m.x, m.y);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        m.x += m.vx;
        m.y += m.vy;
        m.a -= 0.02;
        if (m.a <= 0 || m.x > w + 200 || m.y > h + 200) meteors.splice(i, 1);
      }
    }

    function animate() {
      drawStars();
      drawMeteors();
      if (Math.random() < 0.015) createMeteor();
      requestAnimationFrame(animate);
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    animate();

    const lanternContainer = document.getElementById("lantern-container");
    const wishPopup = document.getElementById("wish-popup");
    const wishes = [
      "üéë Ch√∫c m·ªôt m√πa trƒÉng ƒëo√†n vi√™n, ng·ªçt ng√†o nh∆∞ b√°nh n∆∞·ªõng, ·∫•m √°p nh∆∞ t√¨nh th√¢n",
      "üåï Trung thu vui v·∫ª nh√©! Ch√∫c b·∫°n lu√¥n r·∫°ng r·ª° nh∆∞ √°nh trƒÉng ƒë√™m r·∫±m",
      "Trung thu c√≥ trƒÉng, c√≥ ƒë√®n, c√≥ b√°nh‚Ä¶ c√≥ th·ªÉ tr·ªçn v·∫πn b√™n ng∆∞·ªùi y√™u th∆∞∆°ng",
      "M√πa trƒÉng an l√†nh v√† ng·ªçt ng√†o üçÇ",
      "Ch√∫c b·∫°n lu√¥n s√°ng nh∆∞ trƒÉng r·∫±m üåù",
      "Trung thu c≈©ng l√† d·ªãp ƒë·ªÉ ngh·ªâ ng∆°i v√† t·∫≠n h∆∞·ªüng...",
      "Mong m·ªçi ∆∞·ªõc m∆° c·ªßa b·∫°n ƒë·ªÅu th√†nh hi·ªán th·ª±c üí´"
    ];
    const lanternImages = ["den.png", "den2.png", "den3.png"];

    function createLantern() {
      const lantern = document.createElement("img");
      lantern.src = lanternImages[Math.floor(Math.random() * lanternImages.length)];
      lantern.className = "lantern";

      const layer = Math.floor(Math.random() * 3) + 1;
      let size = 40, duration = 10000, opacity = 0.8;
      if (layer === 1) { size = 25; duration = 15000; opacity = 0.5; }
      else if (layer === 2) { size = 35; duration = 12000; opacity = 0.7; }

      lantern.style.width = size + "px";
      lantern.style.left = Math.random() * 90 + "vw";
      lantern.style.bottom = "0";
      lantern.style.opacity = opacity;

      lanternContainer.appendChild(lantern);

      const drift = Math.random() * 160 - 80;
      const up = 120 + Math.random() * 40;
      lantern.animate(
        [
          { transform: "translate(0,0)", opacity: opacity },
          { transform: `translate(${drift}px, -${up}vh)`, opacity: 0 }
        ],
        { duration, easing: "linear", fill: "forwards" }
      );

      setTimeout(() => lantern.remove(), duration);

      lantern.addEventListener("click", e => {
        e.stopPropagation();
        wishPopup.textContent = wishes[Math.floor(Math.random() * wishes.length)];
        wishPopup.classList.add("show");
        setTimeout(() => wishPopup.classList.remove("show"), 3500);
      });
    }

    setInterval(createLantern, 550);

    const bgMusic = document.getElementById("bg-music");
    function tryPlayMusic() {
      if (!bgMusic) return;
      bgMusic.volume = 0.85;
      const playPromise = bgMusic.play();
      if (playPromise !== undefined) {
        playPromise.catch(() => {
          const oncePlay = () => {
            bgMusic.play().catch(()=>{});
            document.removeEventListener("pointerdown", oncePlay);
          };
          document.addEventListener("pointerdown", oncePlay);
        });
      }
    }
    window.addEventListener("load", tryPlayMusic);

  });
  </script>
</body>
</html>

