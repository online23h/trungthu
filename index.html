<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ƒê√™m Trung Thu ‚Äì n∆°i th·∫£ ƒë√®n tr·ªùi, ng·∫Øm trƒÉng v√† g·ª≠i l·ªùi ch√∫c ng·ªçt ng√†o nh·∫•t.">
  <meta name="theme-color" content="#ff7f50">
  <title>ƒê√™m Trung Thu</title>
  <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #060614;
      font-family: 'Mali', cursive;
      overflow: hidden;
    }

    .stage {
      position: relative;
      width: 100%;
      min-height: 100vh;
      overflow: hidden;
    }

    canvas#starfield {
      display: block;
      width: 100%;
      height: 100%;
    }

    .moon {
      position: absolute;
      top: 60px;
      right: 100px;
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #f8f8f8 70%, #e0e0e0 100%);
      box-shadow:
        0 0 50px #ffffff7a,
        0 0 80px rgba(255, 255, 255, 0.7),
        0 0 100px rgba(255, 255, 255, 0.4);
      filter: drop-shadow(0 0 25px rgba(255, 255, 200, 0.8));
      animation: moonGlow 6s ease-in-out infinite;
      z-index: 10;
    }

    @keyframes moonGlow {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.85; }
    }

    #lantern-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 10;
    }

    .lantern {
      position: absolute;
      width: 40px;
      pointer-events: auto;
      user-select: none;
      animation: swing 2.2s ease-in-out infinite;
      transition: transform 0.3s ease-in-out;
    }

    @keyframes swing {
      0% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
      100% { transform: rotate(-5deg); }
    }

    /* === D√≤ng ‚Äúch·∫°m v√†o ƒë√®n tr·ªùi‚Äù === */
    #hint {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      color: #ffa722;
      font-weight: 800;
      font-size: 28px;
      opacity: 0;
      animation: glowHint 2.5s ease-in-out infinite alternate;
      z-index: 1000;
      text-align: center;
      text-shadow: 0 0 15px #ff8a50, 0 0 25px #ffd180;
    }

    @keyframes glowHint {
      0% { opacity: 0.3; text-shadow: 0 0 10px #ffb380, 0 0 20px #ffda91; }
      100% { opacity: 1; text-shadow: 0 0 25px #ffae50, 0 0 35px #ffd180; }
    }

    /* Popup l·ªùi ch√∫c */
    #wish-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: rgba(255, 255, 255, 0.96);
      color: #ff8d22;
      padding: 35px 40px;
      border-radius: 12px;
      font-size: 1.8rem;
      font-weight: 700;
      display: none;
      opacity: 0;
      text-align: center;
      box-shadow: 0 0 20px #ff8a50, 0 0 25px #ffd180;
      z-index: 9999;
      transition: all 0.5s ease;
    }

    #wish-popup.show {
      display: block;
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    /* === Ph·∫ßn m·ªü ƒë·∫ßu === */
    #intro-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.92);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      white-space: pre-line;
      z-index: 99999;
      opacity: 1;
      transition: opacity 1.2s ease;
      padding: 40px;
      box-sizing: border-box;
      color: #ffa722;
      font-size: 26px;
      font-weight: 700;
      text-shadow: 0 0 15px #ff8a50, 0 0 25px #ffd180;
      line-height: 1.8;
    }

    @media (max-width:600px) {
      .moon { top: 40px; right: 14px; width: 70px; height: 70px; }
      #hint { font-size: 20px; bottom: 60px; }
      #wish-popup { font-size: 1.2rem; padding: 20px 25px; max-width: 80%; }
      #intro-overlay { font-size: 20px; padding: 20px; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <canvas id="starfield"></canvas>
    <div class="moon"></div>
    <div id="lantern-container"></div>
    <div id="wish-popup"></div>
    <div id="hint">Ch·∫°m v√†o ƒë√®n tr·ªùi</div>
    <div id="intro-overlay"></div>

    <audio id="bg-music" loop preload="auto">
      <source src="a.mp3" type="audio/mp3" />
      Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t nh·∫°c.
    </audio>
  </div>

  <script>
    /* === Ph·∫ßn m·ªü ƒë·∫ßu nhanh h∆°n & m∆∞·ª£t h∆°n === */
    const introLines = [
      "Ng√†y b√©, Trung thu l√† ƒë√®n l·ªìng, l√† b√°nh n∆∞·ªõng, l√† r∆∞·ªõc ƒë√®n c√πng l≈© b·∫°n. Gi·ªù l·ªõn r·ªìi..",
      " Trung thu l√† nh·ªØng ho√†i ni·ªám, l√† mong ∆∞·ªõc ƒë∆∞·ª£c quay v·ªÅ nh·ªØng ng√†y v√¥ lo v√¥ nghƒ©.",
      "Nh∆∞ng... ƒê·ª´ng v√¨ tr∆∞·ªüng th√†nh, v√¨ b·ªôn b·ªÅ c√¥ng vi·ªác m√† qu√™n m·∫•t b·∫£n th√¢n c≈©ng c·∫ßn ƒë∆∞·ª£c y√™u th∆∞∆°ng..",
      ".. c·∫ßn ƒë∆∞·ª£c s·ªëng ch·∫≠m l·∫°i ƒë·ªÉ c·∫£m nh·∫≠n √°nh trƒÉng, v·ªã b√°nh, v√† nh·ªØng ƒëi·ªÅu gi·∫£n d·ªã t·ª´ng khi·∫øn ta h·∫°nh ph√∫c."
    ];

    const introBox = document.getElementById("intro-overlay");
    const hint = document.getElementById("hint");

    async function typeText(lines, element, delay = 45) {
      let text = "";
      for (const line of lines) {
        for (const ch of line) {
          text += ch;
          element.textContent = text;
          await new Promise(r => setTimeout(r, delay));
        }
        text += "\n";
        await new Promise(r => setTimeout(r, 300));
      }
    }

    (async () => {
      await typeText(introLines, introBox, 45);
      await new Promise(r => setTimeout(r, 800));
      introBox.style.opacity = "0";
      setTimeout(() => introBox.remove(), 1200);
      // Hi·ªán ‚Äúch·∫°m v√†o ƒë√®n tr·ªùi‚Äù tr·ªÖ nh·∫π
      setTimeout(() => hint.style.opacity = "1", 3200);
    })();

    /* === Hi·ªáu ·ª©ng n·ªÅn === */
    const canvas = document.getElementById("starfield");
    const ctx = canvas.getContext("2d");
    let w, h, stars = [], meteors = [];

    function resizeCanvas() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      stars = Array.from({ length: Math.round((w * h) / 2200) }, () => ({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 0.9 + 0.1,
        a: Math.random() * 0.8 + 0.2,
        t: Math.random() * 0.02 + 0.002
      }));
    }

    function drawStars() {
      ctx.clearRect(0, 0, w, h);
      for (const s of stars) {
        s.a += (Math.random() > 0.5 ? 1 : -1) * s.t;
        s.a = Math.max(0.05, Math.min(1, s.a));
        ctx.beginPath();
        ctx.globalAlpha = s.a;
        ctx.fillStyle = "#fff";
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function createMeteor() {
      meteors.push({
        x: Math.random() * w,
        y: Math.random() * (h / 3),
        vx: 12 + Math.random() * 6,
        vy: 6 + Math.random() * 3,
        len: 100 + Math.random() * 80,
        a: 1
      });
    }

    function drawMeteors() {
      for (let i = meteors.length - 1; i >= 0; i--) {
        const m = meteors[i];
        const x2 = m.x - m.len;
        const y2 = m.y - m.len / 2;
        const grad = ctx.createLinearGradient(m.x, m.y, x2, y2);
        grad.addColorStop(0, `rgba(255,255,255,${m.a})`);
        grad.addColorStop(1, "rgba(255,255,255,0)");
        ctx.strokeStyle = grad;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(m.x, m.y);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        m.x += m.vx;
        m.y += m.vy;
        m.a -= 0.02;
        if (m.a <= 0 || m.x > w + 200 || m.y > h + 200) meteors.splice(i, 1);
      }
    }

    function animate() {
      drawStars();
      drawMeteors();
      if (Math.random() < 0.015) createMeteor();
      requestAnimationFrame(animate);
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    animate();

    /* === ƒê√®n tr·ªùi === */
    const lanternContainer = document.getElementById("lantern-container");
    const wishPopup = document.getElementById("wish-popup");
    const wishes = [
      "Ch√∫c b·∫°n Trung Thu ·∫•m √°p, h·∫°nh ph√∫c üåï",
      "Ch√∫c gia ƒë√¨nh b·∫°n ƒëo√†n vi√™n, vui v·∫ª üéë",
      "M√πa trƒÉng an l√†nh v√† ng·ªçt ng√†o üçÇ",
      "Ch√∫c b·∫°n lu√¥n s√°ng nh∆∞ trƒÉng r·∫±m üåù",
      "Mong m·ªçi ∆∞·ªõc m∆° c·ªßa b·∫°n ƒë·ªÅu th√†nh hi·ªán th·ª±c üí´"
    ];
    const lanternImages = ["den.png", "den2.png", "den3.png"];

    function createLantern() {
      const lantern = document.createElement("img");
      lantern.src = lanternImages[Math.floor(Math.random() * lanternImages.length)];
      lantern.className = "lantern";

      const layer = Math.floor(Math.random() * 3) + 1;
      let size = 40, duration = 10000, opacity = 0.8;
      if (layer === 1) { size = 25; duration = 15000; opacity = 0.5; }
      else if (layer === 2) { size = 35; duration = 12000; opacity = 0.7; }

      lantern.style.width = size + "px";
      lantern.style.left = Math.random() * 90 + "vw";
      lantern.style.bottom = "0";
      lantern.style.opacity = opacity;

      lanternContainer.appendChild(lantern);

      const drift = Math.random() * 160 - 80;
      const up = 120 + Math.random() * 40;
      lantern.animate(
        [
          { transform: "translate(0,0)", opacity: opacity },
          { transform: `translate(${drift}px, -${up}vh)`, opacity: 0 }
        ],
        { duration, easing: "linear", fill: "forwards" }
      );

      setTimeout(() => lantern.remove(), duration);

      lantern.addEventListener("click", e => {
        e.stopPropagation();
        wishPopup.textContent = wishes[Math.floor(Math.random() * wishes.length)];
        wishPopup.classList.add("show");
        setTimeout(() => wishPopup.classList.remove("show"), 3500);
      });
    }

    setInterval(createLantern, 550);

    /* === Nh·∫°c n·ªÅn === */
    const bgMusic = document.getElementById("bg-music");
    let musicStarted = false;
    document.addEventListener("pointerdown", function startMusic() {
      if (!musicStarted && bgMusic) {
        bgMusic.volume = 0;
        bgMusic.play().then(() => {
          let v = 0;
          const fadeIn = setInterval(() => {
            v += 0.05;
            bgMusic.volume = v;
            if (v >= 0.9) clearInterval(fadeIn);
          }, 120);
          musicStarted = true;
        }).catch(() => {});
      }
      document.removeEventListener("pointerdown", startMusic);
    });
  </script>
</body>
</html>

